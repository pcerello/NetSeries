{% extends 'base.html.twig' %} {% block title %}User index{% endblock %} {%
block body %}
<h1>Search an existing user</h1>

<form action="{{ path('app_user_index') }}" method="get"> 
    <input type="text" name="search" placeholder="Search user account...">
</form>

<table class="table">
  <thead>
    <tr>
      <th>Name</th>
      <th>Email</th>
      {# Si l'utilisateur courant est un admin #}
      {% if app.user.isAdmin() %}
        <th>Registration Date</th>
        <th>Admin</th>
        <th>Country</th>
      {% endif %}
      <th>actions</th>

    </tr>
  </thead>
  <tbody>
    {% for user in users %}
      <tr>
        <td>{{ user.name }}</td>
        <td>{{ user.email }}</td>

        {# Si l'utilisateur courant est un admin #}
        {% if app.user.isAdmin() %}
        
          <td>
            {{ user.registerDate ? user.registerDate|date('Y-m-d H:i:s') : '' }}
          </td>
          <td>{{ user.admin ? "✅" : "❌" }}</td>
          <td>{{ user.country }}</td>
        {% endif %}
        <td class="actions">
        {# Si l'utilisateur courant est un admin #}
        {% if app.user.isAdmin() %}
          <a href="{{ path('app_home', {'_switch_user': user.email}) }}">Incarnate 👤</a>
          {% if user.admin == false %}
            {# Promu un utilisateur pour qu'il soit admin #}
            <a href="{{path('app_user_promote', {'id' : user.id})}}">Promote ⬆</a>
          {% else %}
            {# Destituer un admin #}
            <a href="{{path('app_user_demote', {'id' : user.id})}}">Demote ⬇</a>
          {% endif %}
          <a href="{{ path('app_user_profil', {'id' : user.id}) }}">User profil</a>
            
        {% endif %}
          {# Lien pour voir la fiche d'un utilisateur #}
          <a href="{{ path('app_user_show', {'id' : user.id} )}}">See this user's profile</a>
          </td>
        </td>
      </tr>
    {% else %}
    <tr>
      <td colspan="8">no records found</td>
    </tr>
    {% endfor %}
  </tbody>
</table>




{# Permet de mettre en place la pagination des utilisateurs #}
<div class="navigation">
    {{ knp_pagination_render(users) }}
</div>

{# Si un utilisateur connecté #}
{% if app.user %}

  {# Et que c'est un admin #}
  {% if app.user.isAdmin() %}  
    <form action="{{ path('generateUser', {'id': app.user.id}) }}" method="POST" >
      <label for="user_count">Generate users : </label>
      <input type="number" name="user_count" id="user_count" min="1" required>
      <input type="submit" value="Generate">
    </form>

    <form action="{{ path('generateCritic', {'id': app.user.id}) }}" method="POST" >
      <label for="critic_count">Generate critic on a random user : </label>
      <input type="number" name="critic_count" id="critic_count" min="1" max="{{series|length}}" required>
      <input type="submit" value="Generate">
    </form>

  
  {% endif %}
{% endif %}

{% endblock %} {% block stylesheets %}
{{ parent() }}
<link
  rel="stylesheet"
  href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
/>
<link
  rel="stylesheet"
  href="{{ asset('css/users_list.css') }}">
{% endblock %}
